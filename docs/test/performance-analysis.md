# 성능 지표 분석 및 병목 지점 탐색

## 1. 성능 지표 요약

부하 테스트 결과를 기반으로 주요 성능 지표를 정리하면 다음과 같습니다:

* **총 요청 수** (`http_reqs`): 2,521건
* **성공한 요청 수** (`checks`): 2,520건 (99.96%)
* **실패한 요청 수**: 1건 (0.04%)
* **평균 응답 시간** (`avg`): 1.23초
* **최소 응답 시간** (`min`): 9.28ms
* **최대 응답 시간** (`max`): 14.89초
* **중간값 응답 시간** (`med`): 234.14ms
* **90번째 백분위수 응답 시간** (`p(90)`): 2.68초
* **95번째 백분위수 응답 시간** (`p(95)`): 11.84초
* **초당 처리량** (`http_reqs/s`): 약 27.89건/초
* **에러율** (`http_req_failed`): 0%

## 2. 응답 시간 분석

### 2-1. 평균 응답 시간
* 평균 응답 시간이 **1.23초**로, 설정한 임계치인 **200ms**를 크게 초과하였습니다.
* **중간값 응답 시간**이 **234.14ms**인 것에 비해 평균 응답 시간이 높아, 일부 요청에서 응답 시간이 크게 지연되는 현상이 있음을 알 수 있습니다.

### 2-2. 최대 응답 시간
* 최대 응답 시간이 **14.89초**로, 사용자 경험에 심각한 영향을 미칠 수 있는 수준입니다.
* 이는 특정 상황에서 시스템의 부하가 급격히 증가하거나, 응답 지연이 발생하는 병목 지점이 존재함을 시사합니다.

### 2-3. 백분위수 응답 시간
* **90%** 의 요청이 **2.68초** 이내에 처리되고 있으며, 이는 여전히 높은 응답 시간입니다.
* **95%** 의 요청은 **11.84초** 이내에 처리되어, 상위 5%의 요청에서 심각한 지연이 발생하고 있습니다.
* 최상위 5%의 요청에서 응답 시간이 상대적으로 길어지는 현상이 관찰됩니다.

### 2-4. 응답 시간 분포
* 응답 시간의 분포를 분석한 결과, 대부분의 요청이 **1초 이내** 에 처리되지만, 일부 요청에서 **10초 이상의 지연**이 발생하고 있습니다.
* 이는 시스템 내 특정 컴포넌트에서 병목 현상이 발생하고 있음을 나타냅니다.

## 3. 처리량 분석

### 3-1. 초당 처리량
* 초당 약 **27.89건** 의 요청을 처리하였습니다.
* VUser 수에 비례하여 처리량이 증가하는 경향을 보이지만, **응답 시간 지연**으로 인해 처리량 증가에 한계가 있습니다.

### 3-2. 사용자 수 대비 처리량
* VUser 수가 증가함에 따라 응답 시간이 급격히 증가하여, **동시 사용자 증가에 따른 선형 확장**이 어려운 상태입니다.
* 이는 시스템의 **확장성에 문제가 있음**을 나타냅니다.

### 3-3. 시스템 자원 사용량
* **CPU 사용률**: 평균 **85% 이상**으로, 최대치에 근접하였습니다.
* **메모리 사용량**: **70% 이상**으로, 안정적인 운영을 위한 여유 메모리가 부족합니다.
* **네트워크 대역폭**: 사용량이 증가하여 **네트워크 지연**을 초래할 가능성이 있습니다.

### 3-4. 에러율 분석
* 테스트 동안 **에러율은 0%** 로, 모든 요청이 성공적으로 처리되었습니다.
* 그러나 **응답 시간 지연**으로 인해 사용자 만족도가 저하될 수 있으며, 실제 운영 환경에서는 타임아웃 등의 오류가 발생할 수 있습니다.

## 4. 병목 지점 식별

### 4-1. 데이터베이스 부하 증가
* **좌석 조회 API** (`/v1/api/concerts/seat`)에서 데이터베이스에 대한 빈번한 접근으로 부하가 증가하고 있습니다.
* 테스트 동안 **DB CPU 사용률이 평균 85%** 까지 상승하였으며, 이는 데이터베이스가 처리할 수 있는 **최대 용량에 근접**하였음을 의미합니다.

### 4-2. 캐싱 전략 부재
* **콘서트 일정 조회 API**와 **좌석 조회 API**에서 캐싱이 적용되지 않아 **동일한 데이터에 대한 반복적인 데이터베이스 쿼리**가 발생하고 있습니다.
* **캐시 적중률이 0%** 로, 불필요한 데이터베이스 부하를 초래하고 있습니다.

### 4-3. Redis 부하 및 경합
* **대기열 처리**와 **분산 락**으로 인해 Redis에 대한 요청이 집중되고 있습니다.
* Redis의 **싱글 스레드 특성**으로 인해 요청 경합이 발생하여 응답 시간 지연을 유발하고 있습니다.

### 4-4. Kafka 처리 지연
* **결제 처리 시 Kafka를 통한 메시지 전송**으로 부하가 증가하고 있습니다.
* 외부 시스템과의 **통신 지연**으로 전체 응답 시간이 증가하고 있습니다.

### 4-5. 서버 리소스 부족
* 제한된 **CPU 및 메모리 자원**으로 인해 서버의 처리 능력이 한계에 도달하였습니다.
* CPU 사용률이 높아 **컨텍스트 스위칭**과 **스레드 경합**이 발생하고 있습니다.

## 5. 개선 방안

### 5-1. 서버 스케일링
* **스케일 업**: 서버의 **CPU 및 메모리 자원 증설**로 처리 능력을 향상시킵니다.
* **스케일 아웃**: **로드 밸런서**를 도입하여 서버를 추가하고 부하를 분산시킵니다.

### 5-2. 캐싱 전략 도입
* **콘서트 일정 조회** 및 **좌석 조회 API**에 캐싱을 적용하여 **데이터베이스 부하를 감소**시킵니다.
* Redis를 활용하여 **캐시 적중률을 향상**시키고, 데이터 일관성을 유지하기 위한 **만료 정책**을 설정합니다.

### 5-3. 데이터베이스 최적화
* **인덱스 추가 및 최적화**를 통해 쿼리 성능을 향상시킵니다.
* **쿼리 튜닝**을 통해 불필요한 데이터 조회를 최소화하고, 필요한 데이터만 선택적으로 조회합니다.

### 5-4. Redis 클러스터링
* Redis를 **클러스터링**하여 부하를 분산하고, 싱글 스레드로 인한 경합을 완화합니다.
* **연결 풀 최적화** 및 **파이프라이닝**을 적용하여 성능을 향상시킵니다.

### 5-5. Kafka 성능 개선
* **Kafka 브로커 수 증가** 및 클러스터링을 통해 메시지 처리량을 향상시킵니다.
* **아웃박스 패턴**을 적용하여 트랜잭션 일관성을 확보하고 성능을 개선합니다.

### 5-6. 서킷브레이커 설정 조정
* **Failure Rate Threshold**를 조정하여 서킷이 과도하게 열리는 것을 방지합니다.
* **슬라이딩 윈도우 크기**를 늘려 일시적인 오류에 민감하게 반응하지 않도록 설정합니다.

### 5-7. 시스템 모니터링 및 알림 강화
* Grafana와 Prometheus를 활용하여 **실시간 모니터링**을 강화합니다.
* 임계치 초과 시 **자동 알림**을 통해 신속한 대응이 가능하도록 합니다.

## 6. (가상) 장애 대응 문서

### 장애 상황 발생 시 대응 절차

### 6-1. 장애 인지
* 시스템 모니터링 도구를 통해 **응답 시간 지연** 및 **에러율 상승**을 감지합니다.
* 자동 알림 시스템을 통해 **운영 담당자에게 즉시 통보**됩니다.

### 6-2. 초기 대응
* **서킷브레이커**를 통해 장애가 발생한 서비스로의 추가 요청을 차단하여 시스템 전체의 안정성을 확보합니다.
* 장애 발생 지점의 **로그 및 메트릭**을 수집하여 원인을 파악합니다.

### 6-3. 원인 분석
* **Redis** 및 **데이터베이스**의 부하 상태를 확인합니다.
* 특정 API에서의 **요청 증가**나 외부 시스템(Kafka)과의 **통신 지연** 여부를 조사합니다.

### 6-4. 조치 방안 실행
* 필요한 경우 **서버 자원을 증설**하거나 **서비스를 재시작**하여 임시적으로 부하를 완화합니다.
* Redis 및 Kafka의 상태를 점검하고, 필요 시 **클러스터를 재구성**합니다.

### 6-5. 사후 처리
* 장애 원인을 근본적으로 해결하기 위한 **개선 작업**을 수행합니다.
* 재발 방지를 위한 **모니터링 지표** 및 **알림 임계치**를 재설정합니다.

### 6-6. 보고 및 공유
* 장애 발생 원인과 대응 과정을 **문서화**하여 관련 팀과 공유합니다.
* 향후 대응 시나리오를 업데이트하여 **대응 속도와 효율성**을 향상시킵니다.

### 예상되는 장애 유형 및 대응 방안

#### 데이터베이스 과부하
* **증상**: 응답 시간 지연, 쿼리 타임아웃 발생
* **대응**: 즉시 **쿼리 튜닝** 및 **인덱스 최적화** 수행, 필요 시 **리드 레플리카** 추가

#### Redis 경합 발생
* **증상**: 대기열 처리 지연, Redis 연결 오류
* **대응**: Redis **클러스터링 도입**, **연결 풀 크기 조정**

#### Kafka 메시지 처리 지연
* **증상**: 결제 처리 지연, 메시지 큐 적체
* **대응**: Kafka **브로커 추가**, 메시지 **압축** 및 **배치 처리** 최적화

#### 서버 자원 부족
* **증상**: CPU 사용률 100%, 메모리 부족으로 인한 OOM 발생
* **대응**: 서버 **스케일 아웃/업**, **자동 스케일링** 설정 적용